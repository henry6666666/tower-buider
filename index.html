<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Anton Tower Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            touch-action: manipulation;
        }

        .game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: white;
            font-size: 3em;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2em;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            margin: 0 auto;
            perspective: 1000px;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB, #98FB98);
            border-radius: 15px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            display: block;
            cursor: pointer;
            transform-style: preserve-3d;
        }

        /* 3D 菜单系统 */
        .menu-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transform-style: preserve-3d;
        }

        .menu-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 15px;
            transform: translateZ(-50px);
        }

        .menu-content {
            position: relative;
            z-index: 1001;
            text-align: center;
            width: 90%;
            max-width: 400px;
            transform: translateZ(50px);
        }

        .menu-title {
            color: white;
            margin-bottom: 40px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            transform: translateZ(100px);
        }

        .menu-button {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 18px 40px;
            margin: 15px 0;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            display: block;
            transform: translateZ(80px);
            transform-style: preserve-3d;
        }

        .menu-button:hover {
            transform: translateZ(80px) translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }

        .settings-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            transform: translateZ(60px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .settings-title {
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.8em;
            transform: translateZ(40px);
        }

        .setting-group {
            margin: 20px 0;
            transform: translateZ(30px);
        }

        .setting-group h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .difficulty-buttons, .language-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .option-button {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            text-align: center;
            transform: translateZ(20px);
        }

        .option-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            transform: translateZ(30px);
        }

        .back-button {
            background: #6c757d !important;
            margin-top: 20px;
        }

        .score-display {
            position: absolute;
            top: 30px;
            left: 30px;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 5;
            transform: translateZ(100px);
        }

        .controls-info {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 1.1em;
            opacity: 0.8;
            transform: translateZ(100px);
        }

        .camera-controls {
            position: absolute;
            top: 30px;
            right: 30px;
            color: white;
            font-size: 1em;
            z-index: 5;
            transform: translateZ(100px);
        }

        /* 隐藏类 */
        .hidden {
            display: none !important;
        }

        /* 3D 动画 */
        @keyframes float {
            0%, 100% { transform: translateZ(50px) translateY(0px); }
            50% { transform: translateZ(50px) translateY(-10px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .game-container {
                max-width: 100%;
                padding: 15px;
            }
            
            .canvas-container {
                height: 400px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .menu-title {
                font-size: 2em;
            }
            
            .menu-button {
                padding: 15px 30px;
                font-size: 1.1em;
            }
        }

        @media (max-width: 480px) {
            .canvas-container {
                height: 350px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .settings-panel {
                padding: 20px;
            }
            
            .score-display {
                font-size: 1.2em;
                top: 20px;
                left: 20px;
            }
            
            .controls-info {
                bottom: 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="floating">3D Anton Tower Builder</h1>
            <div class="subtitle">建造最高的3D塔楼！</div>
        </div>

        <div class="canvas-container">
            <canvas id="gameCanvas"></canvas>
            <div class="score-display" id="scoreDisplay">高度: 0</div>
            <div class="camera-controls" id="cameraControls">
                视角: 45° | 使用鼠标拖拽旋转视角
            </div>
            <div class="controls-info" id="controlsInfo">
                按空格键放置方块 | 当前速度: 正常
            </div>
        </div>

        <!-- 主菜单 -->
        <div class="menu-layer" id="mainMenu">
            <div class="menu-background"></div>
            <div class="menu-content">
                <h2 class="menu-title floating">3D Tower Builder</h2>
                <button class="menu-button" id="startBtn">开始游戏</button>
                <button class="menu-button" id="settingsBtn">设置</button>
            </div>
        </div>

        <!-- 设置菜单 -->
        <div class="menu-layer hidden" id="settingsMenu">
            <div class="menu-background"></div>
            <div class="menu-content">
                <div class="settings-panel">
                    <h3 class="settings-title">设置</h3>
                    
                    <div class="setting-group">
                        <h4>难度设置</h4>
                        <div class="difficulty-buttons">
                            <button class="option-button active" data-difficulty="easy">简单模式</button>
                            <button class="option-button" data-difficulty="normal">正常模式</button>
                            <button class="option-button" data-difficulty="hard">地狱模式</button>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h4>语言选择</h4>
                        <div class="language-buttons">
                            <button class="option-button active" data-language="zh">中文</button>
                            <button class="option-button" data-language="en">English</button>
                            <button class="option-button" data-language="es">Español</button>
                            <button class="option-button" data-language="fr">Français</button>
                            <button class="option-button" data-language="de">Deutsch</button>
                            <button class="option-button" data-language="ja">日本語</button>
                            <button class="option-button" data-language="ko">한국어</button>
                            <button class="option-button" data-language="ru">Русский</button>
                            <button class="option-button" data-language="pt">Português</button>
                            <button class="option-button" data-language="ar">العربية</button>
                        </div>
                    </div>
                    
                    <button class="menu-button back-button" id="backFromSettings">返回主菜单</button>
                </div>
            </div>
        </div>

        <!-- 游戏结束菜单 -->
        <div class="menu-layer hidden" id="gameOverMenu">
            <div class="menu-background"></div>
            <div class="menu-content">
                <h2 class="menu-title">游戏结束！</h2>
                <p id="finalScore" style="color: white; font-size: 1.8em; margin-bottom: 30px; transform: translateZ(80px);">最终高度: 0</p>
                <button class="menu-button" id="restartBtn">再玩一次</button>
                <button class="menu-button back-button" id="backToMenu">返回主菜单</button>
            </div>
        </div>
    </div>

    <script>
        // 多语言文本
        const translations = {
            zh: {
                title: "3D Anton Tower Builder",
                subtitle: "建造最高的3D塔楼！",
                startBtn: "开始游戏",
                settingsBtn: "设置",
                backBtn: "返回主菜单",
                difficulty: "难度设置",
                language: "语言选择",
                easy: "简单模式",
                normal: "正常模式",
                hard: "地狱模式",
                controls: "按空格键或点击屏幕放置方块",
                height: "高度",
                finalHeight: "最终高度",
                gameOver: "游戏结束！",
                restart: "再玩一次",
                speed: "速度",
                camera: "视角",
                cameraHint: "使用鼠标拖拽旋转视角"
            },
            en: {
                title: "3D Anton Tower Builder",
                subtitle: "Build the tallest 3D tower!",
                startBtn: "Start Game",
                settingsBtn: "Settings",
                backBtn: "Back to Menu",
                difficulty: "Difficulty",
                language: "Language",
                easy: "Easy Mode",
                normal: "Normal Mode",
                hard: "Hard Mode",
                controls: "Press SPACE or tap to place block",
                height: "Height",
                finalHeight: "Final Height",
                gameOver: "Game Over!",
                restart: "Play Again",
                speed: "Speed",
                camera: "Camera",
                cameraHint: "Drag with mouse to rotate view"
            }
        };

        // 游戏变量
        let canvas, ctx;
        let currentBlock, tower = [];
        let blockSpeed = 2;
        let direction = 1;
        let score = 0;
        let gameRunning = false;
        let currentLanguage = 'zh';
        let difficulty = 'normal';
        
        // 3D 变量
        let cameraAngle = 45;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;

        // 初始化游戏
        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // 设置画布尺寸
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            console.log('3D Canvas initialized:', canvas.width, 'x', canvas.height);
            
            // 初始化第一个方块
            currentBlock = {
                x: canvas.width / 2 - 40,
                y: canvas.height - 100,
                width: 80,
                height: 30,
                depth: 60,
                color: getRandomColor(),
                speed: blockSpeed
            };
            
            // 初始化塔（基础）
            tower = [{
                x: canvas.width / 2 - 60,
                y: canvas.height - 30,
                width: 120,
                height: 30,
                depth: 80,
                color: '#8B4513'
            }];
            
            // 重置分数
            score = 0;
            updateScore();
            
            // 根据难度调整速度
            switch(difficulty) {
                case 'easy':
                    blockSpeed = 1.5;
                    break;
                case 'normal':
                    blockSpeed = 2;
                    break;
                case 'hard':
                    blockSpeed = 3;
                    break;
            }
            
            currentBlock.speed = blockSpeed;
            updateControlsInfo();
        }

        // 获取随机颜色
        function getRandomColor() {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // 绘制3D方块
        function draw3DBlock(block) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // 计算3D变换
            const angle = cameraAngle * Math.PI / 180;
            const scale = 0.8 + Math.sin(angle) * 0.2;
            
            // 计算位置（带透视效果）
            const blockX = centerX + (block.x - centerX) * scale;
            const blockY = block.y - Math.sin(angle) * block.depth * 0.5;
            const blockWidth = block.width * scale;
            const blockHeight = block.height;
            
            // 绘制主面
            ctx.fillStyle = block.color;
            ctx.fillRect(blockX, blockY, blockWidth, blockHeight);
            
            // 绘制顶部（3D效果）
            ctx.fillStyle = shadeColor(block.color, -20);
            ctx.beginPath();
            ctx.moveTo(blockX, blockY);
            ctx.lineTo(blockX + blockWidth, blockY);
            ctx.lineTo(blockX + blockWidth - block.depth * 0.3, blockY - block.depth * 0.3);
            ctx.lineTo(blockX - block.depth * 0.3, blockY - block.depth * 0.3);
            ctx.closePath();
            ctx.fill();
            
            // 绘制侧面（3D效果）
            ctx.fillStyle = shadeColor(block.color, -40);
            ctx.beginPath();
            ctx.moveTo(blockX + blockWidth, blockY);
            ctx.lineTo(blockX + blockWidth, blockY + blockHeight);
            ctx.lineTo(blockX + blockWidth - block.depth * 0.3, blockY + blockHeight - block.depth * 0.3);
            ctx.lineTo(blockX + blockWidth - block.depth * 0.3, blockY - block.depth * 0.3);
            ctx.closePath();
            ctx.fill();
            
            // 边框
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.lineWidth = 2;
            ctx.strokeRect(blockX, blockY, blockWidth, blockHeight);
        }

        // 颜色阴影计算
        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1, 3), 16);
            let G = parseInt(color.substring(3, 5), 16);
            let B = parseInt(color.substring(5, 7), 16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R < 255) ? R : 255;
            G = (G < 255) ? G : 255;
            B = (B < 255) ? B : 255;

            return `#${R.toString(16).padStart(2, '0')}${G.toString(16).padStart(2, '0')}${B.toString(16).padStart(2, '0')}`;
        }

        // 绘制当前移动的方块
        function drawCurrentBlock() {
            draw3DBlock(currentBlock);
        }

        // 绘制塔
        function drawTower() {
            tower.forEach(block => {
                draw3DBlock(block);
            });
        }

        // 绘制3D地面
        function draw3DGround() {
            const centerX = canvas.width / 2;
            const angle = cameraAngle * Math.PI / 180;
            const scale = 0.8 + Math.sin(angle) * 0.2;
            
            // 地面
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
            
            // 地面阴影和3D效果
            ctx.fillStyle = shadeColor('#8B4513', -30);
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 30);
            ctx.lineTo(canvas.width, canvas.height - 30);
            ctx.lineTo(canvas.width - canvas.width * 0.1, canvas.height - 30 - 20);
            ctx.lineTo(canvas.width * 0.1, canvas.height - 30 - 20);
            ctx.closePath();
            ctx.fill();
        }

        // 更新当前方块位置
        function updateCurrentBlock() {
            if (!currentBlock) return;
            
            currentBlock.x += currentBlock.speed * direction;
            
            // 碰到边界反弹（考虑3D透视）
            const centerX = canvas.width / 2;
            const angle = cameraAngle * Math.PI / 180;
            const scale = 0.8 + Math.sin(angle) * 0.2;
            const effectiveWidth = currentBlock.width * scale;
            
            if (currentBlock.x <= centerX - canvas.width/3 || 
                currentBlock.x + effectiveWidth >= centerX + canvas.width/3) {
                direction *= -1;
            }
        }

        // 放置方块
        function placeBlock() {
            if (!currentBlock || !gameRunning) return;
            
            const lastBlock = tower[tower.length - 1];
            
            // 检查放置精度（考虑3D透视）
            const centerX = canvas.width / 2;
            const angle = cameraAngle * Math.PI / 180;
            const scale = 0.8 + Math.sin(angle) * 0.2;
            
            const currentEffectiveX = centerX + (currentBlock.x - centerX) * scale;
            const lastEffectiveX = centerX + (lastBlock.x - centerX) * scale;
            
            const overlap = Math.min(
                currentEffectiveX + currentBlock.width * scale,
                lastEffectiveX + lastBlock.width * scale
            ) - Math.max(currentEffectiveX, lastEffectiveX);
            
            if (overlap > 0) {
                // 成功放置
                const newBlock = {
                    x: currentBlock.x,
                    y: lastBlock.y - currentBlock.height,
                    width: Math.max(40, currentBlock.width - 5),
                    height: 30,
                    depth: Math.max(40, currentBlock.depth - 5),
                    color: currentBlock.color
                };
                
                tower.push(newBlock);
                score++;
                updateScore();
                
                // 创建新方块
                currentBlock = {
                    x: canvas.width / 2 - 40,
                    y: newBlock.y - currentBlock.height,
                    width: 80,
                    height: 30,
                    depth: 60,
                    color: getRandomColor(),
                    speed: blockSpeed
                };
                
                // 每5层增加一点速度
                if (score % 5 === 0) {
                    blockSpeed += 0.2;
                    currentBlock.speed = blockSpeed;
                    updateControlsInfo();
                }
                
                return true;
            } else {
                // 放置失败
                gameOver();
                return false;
            }
        }

        // 更新分数显示
        function updateScore() {
            document.getElementById('scoreDisplay').textContent = 
                translations[currentLanguage].height + ': ' + score;
        }

        // 更新控制信息
        function updateControlsInfo() {
            const speedText = {
                'easy': translations[currentLanguage].easy,
                'normal': translations[currentLanguage].normal,
                'hard': translations[currentLanguage].hard
            };
            
            document.getElementById('controlsInfo').textContent = 
                translations[currentLanguage].controls + ' | ' + 
                translations[currentLanguage].speed + ': ' + speedText[difficulty];
            
            document.getElementById('cameraControls').textContent = 
                translations[currentLanguage].camera + ': ' + Math.round(cameraAngle) + '° | ' + 
                translations[currentLanguage].cameraHint;
        }

        // 游戏循环
        function gameLoop() {
            if (!gameRunning) return;
            
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制3D背景
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制3D地面
            draw3DGround();
            
            // 更新和绘制
            updateCurrentBlock();
            drawTower();
            drawCurrentBlock();
            
            // 继续游戏循环
            requestAnimationFrame(gameLoop);
        }

        // 游戏结束
        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = 
                translations[currentLanguage].finalHeight + ': ' + score;
            showMenu('gameOverMenu');
        }

        // 显示菜单
        function showMenu(menuId) {
            // 隐藏所有菜单
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('settingsMenu').classList.add('hidden');
            document.getElementById('gameOverMenu').classList.add('hidden');
            
            // 显示指定菜单
            if (menuId !== 'none') {
                document.getElementById(menuId).classList.remove('hidden');
            }
        }

        // 开始游戏
        function startGame() {
            console.log('Starting 3D game...');
            initGame();
            gameRunning = true;
            showMenu('none');
            gameLoop();
        }

        // 切换语言
        function changeLanguage(lang) {
            currentLanguage = lang;
            updateTexts();
        }

        // 更新所有文本
        function updateTexts() {
            const t = translations[currentLanguage];
            
            document.querySelector('h1').textContent = t.title;
            document.querySelector('.subtitle').textContent = t.subtitle;
            
            document.getElementById('startBtn').textContent = t.startBtn;
            document.getElementById('settingsBtn').textContent = t.settingsBtn;
            document.getElementById('backFromSettings').textContent = t.backBtn;
            document.getElementById('backToMenu').textContent = t.backBtn;
            
            document.querySelector('.settings-title').textContent = t.settingsBtn;
            document.querySelectorAll('.setting-group h4')[0].textContent = t.difficulty;
            document.querySelectorAll('.setting-group h4')[1].textContent = t.language;
            
            // 更新难度按钮
            document.querySelectorAll('.difficulty-buttons .option-button').forEach((btn, index) => {
                const difficulties = [t.easy, t.normal, t.hard];
                btn.textContent = difficulties[index];
            });
            
            // 更新游戏结束文本
            document.querySelector('#gameOverMenu .menu-title').textContent = t.gameOver;
            document.getElementById('finalScore').textContent = t.finalHeight + ': 0';
            document.getElementById('restartBtn').textContent = t.restart;
            
            updateScore();
            updateControlsInfo();
        }

        // 鼠标拖拽控制视角
        function initMouseControls() {
            canvas.addEventListener('mousedown', function(e) {
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            });

            canvas.addEventListener('mousemove', function(e) {
                if (isDragging && gameRunning) {
                    const deltaX = e.clientX - lastMouseX;
                    cameraAngle += deltaX * 0.5;
                    
                    // 限制视角范围
                    cameraAngle = Math.max(10, Math.min(80, cameraAngle));
                    
                    lastMouseX = e.clientX;
                    lastMouseY = e.clientY;
                    updateControlsInfo();
                }
            });

            canvas.addEventListener('mouseup', function() {
                isDragging = false;
            });

            canvas.addEventListener('mouseleave', function() {
                isDragging = false;
            });

            // 触摸屏支持
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                isDragging = true;
                lastMouseX = e.touches[0].clientX;
                lastMouseY = e.touches[0].clientY;
            });

            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                if (isDragging && gameRunning) {
                    const deltaX = e.touches[0].clientX - lastMouseX;
                    cameraAngle += deltaX * 0.5;
                    
                    cameraAngle = Math.max(10, Math.min(80, cameraAngle));
                    
                    lastMouseX = e.touches[0].clientX;
                    lastMouseY = e.touches[0].clientY;
                    updateControlsInfo();
                }
            });

            canvas.addEventListener('touchend', function() {
                isDragging = false;
            });
        }

        // 初始化事件监听
        function initEventListeners() {
            console.log('Initializing 3D event listeners...');
            
            // 主菜单按钮
            document.getElementById('startBtn').onclick = function() {
                console.log('Start button clicked');
                startGame();
            };
            
            document.getElementById('settingsBtn').onclick = function() {
                console.log('Settings button clicked');
                showMenu('settingsMenu');
            };
            
            // 难度选择
            document.querySelectorAll('.difficulty-buttons .option-button').forEach(btn => {
                btn.onclick = function() {
                    console.log('Difficulty selected:', this.dataset.difficulty);
                    document.querySelectorAll('.difficulty-buttons .option-button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    difficulty = this.dataset.difficulty;
                };
            });
            
            // 语言选择
            document.querySelectorAll('.language-buttons .option-button').forEach(btn => {
                btn.onclick = function() {
                    console.log('Language selected:', this.dataset.language);
                    document.querySelectorAll('.language-buttons .option-button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    changeLanguage(this.dataset.language);
                };
            });
            
            // 返回按钮
            document.getElementById('backFromSettings').onclick = function() {
                console.log('Back from settings clicked');
                showMenu('mainMenu');
            };
            
            // 游戏结束按钮
            document.getElementById('restartBtn').onclick = function() {
                console.log('Restart button clicked');
                startGame();
            };
            
            document.getElementById('backToMenu').onclick = function() {
                console.log('Back to menu clicked');
                showMenu('mainMenu');
            };
            
            // 键盘控制
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space' && gameRunning) {
                    e.preventDefault();
                    console.log('Space pressed, placing block...');
                    placeBlock();
                }
            });
            
            // 触摸控制
            canvas.addEventListener('click', function() {
                if (gameRunning) {
                    console.log('Canvas clicked, placing block...');
                    placeBlock();
                }
            });
            
            // 初始化鼠标控制
            initMouseControls();
            
            // 窗口大小变化
            window.addEventListener('resize', function() {
                if (!gameRunning) {
                    initGame();
                }
            });
        }

        // 页面加载完成后初始化
        window.onload = function() {
            console.log('Page loaded, initializing 3D game...');
            initGame();
            updateTexts();
            initEventListeners();
            console.log('3D Game initialized successfully!');
        };
    </script>
</body>
</html>
